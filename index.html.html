<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Discipline Protocol</title>
    <!-- Essential Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0d0f12; margin: 0; overflow: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        
        // === PASTE ALL CODE FROM THE CANVAS BELOW THIS LINE ===
// --- LIBRARY ACCESS (Browser Compatible) ---
const { useState, useMemo, useEffect, useRef } = React;
const { 
  RadarChart, PolarGrid, PolarAngleAxis, Radar, ResponsiveContainer,
  BarChart, Bar, XAxis, YAxis, Tooltip: RechartsTooltip, Cell 
} = window.Recharts || {};

// --- ICON HELPER (Browser Compatible) ---
const LucideIcon = ({ name, size = 20, className = "" }) => {
  const iconRef = useRef(null);
  useEffect(() => {
    if (window.lucide && iconRef.current) {
      const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
      iconRef.current.innerHTML = `<i data-lucide="${kebabName}"></i>`;
      window.lucide.createIcons({
        attrs: { width: size, height: size, class: className }
      });
    }
  }, [name, size, className]);
  return <span ref={iconRef} className="inline-flex items-center justify-center leading-none" />;
};

// --- CONFIGURATION ---
const YEAR = 2026;
const START_DATE = new Date(YEAR, 0, 1);
const DAYS_IN_YEAR = 365;

const INITIAL_CATEGORIES = [
  { id: 'cat-1', name: 'HEALTH', color: '#10b981' },
  { id: 'cat-2', name: 'MINDSET', color: '#3b82f6' },
  { id: 'cat-3', name: 'FINANCE', color: '#f59e0b' },
  { id: 'cat-4', name: 'CAREER', color: '#a855f7' },
];

const INITIAL_TASKS = [
  { id: 't1', catId: 'cat-1', name: 'Morning Workout' },
  { id: 't2', catId: 'cat-1', name: 'Clean Diet' },
  { id: 't3', catId: 'cat-2', name: 'Meditation (15m)' },
  { id: 't4', catId: 'cat-2', name: 'Daily Reading' },
  { id: 't5', catId: 'cat-3', name: 'Expense Tracking' },
  { id: 't6', catId: 'cat-4', name: 'Skill Building' },
];

const App = () => {
  const [view, setView] = useState('tracker'); 
  
  // --- PERSISTENCE: LOAD FROM LOCALSTORAGE ---
  const [categories, setCategories] = useState(() => {
    const saved = localStorage.getItem('habit_categories');
    return saved ? JSON.parse(saved) : INITIAL_CATEGORIES;
  });
  
  const [tasks, setTasks] = useState(() => {
    const saved = localStorage.getItem('habit_tasks');
    return saved ? JSON.parse(saved) : INITIAL_TASKS;
  });
  
  const [logs, setLogs] = useState(() => {
    const saved = localStorage.getItem('habit_logs');
    return saved ? JSON.parse(saved) : {};
  });
  
  const [notes, setNotes] = useState(() => {
    const saved = localStorage.getItem('habit_notes');
    return saved ? JSON.parse(saved) : {};
  });

  const [selectedDay, setSelectedDay] = useState(null); 
  const [isManageOpen, setIsManageOpen] = useState(false);
  const [activeDayIdx, setActiveDayIdx] = useState(0);
  
  const [newCatName, setNewCatName] = useState('');
  const [newCatColor, setNewCatColor] = useState('#10b981');
  const [newTaskNames, setNewTaskNames] = useState({});

  const scrollContainerRef = useRef(null);

  // --- PERSISTENCE: SAVE ON CHANGE ---
  useEffect(() => { localStorage.setItem('habit_categories', JSON.stringify(categories)); }, [categories]);
  useEffect(() => { localStorage.setItem('habit_tasks', JSON.stringify(tasks)); }, [tasks]);
  useEffect(() => { localStorage.setItem('habit_logs', JSON.stringify(logs)); }, [logs]);
  useEffect(() => { localStorage.setItem('habit_notes', JSON.stringify(notes)); }, [notes]);

  // --- DATE LOGIC: CALCULATE "TODAY" INDEX ---
  const updateCurrentDay = () => {
    const today = new Date();
    if (today.getFullYear() === YEAR) {
      // Math: Current Time minus Jan 1st 2026, divided by milliseconds in a day
      const diff = today - START_DATE;
      const idx = Math.floor(diff / (1000 * 60 * 60 * 24));
      setActiveDayIdx(idx >= 0 && idx < DAYS_IN_YEAR ? idx : 0);
    } else if (today.getFullYear() > YEAR) {
      // If we are in 2027, the whole 2026 roadmap is unlocked
      setActiveDayIdx(DAYS_IN_YEAR - 1);
    } else {
      // If it's still 2025, we are at the start (Day 0)
      setActiveDayIdx(0);
    }
  };

  useEffect(() => {
    updateCurrentDay();
    // Check every minute to see if the date changed (e.g. at midnight)
    const interval = setInterval(updateCurrentDay, 60000);
    return () => clearInterval(interval);
  }, []);

  const addCategory = () => {
    if (!newCatName.trim()) return;
    const newId = `cat-${Date.now()}`;
    setCategories([...categories, { id: newId, name: newCatName.toUpperCase(), color: newCatColor }]);
    setNewCatName('');
  };

  const removeCategory = (id) => {
    setCategories(categories.filter(c => c.id !== id));
    setTasks(tasks.filter(t => t.catId !== id));
  };

  const addTask = (catId) => {
    const name = newTaskNames[catId];
    if (!name || !name.trim()) return;
    const newId = `t-${Date.now()}`;
    setTasks([...tasks, { id: newId, catId, name: name.trim() }]);
    setNewTaskNames({ ...newTaskNames, [catId]: '' });
  };

  const removeTask = (id) => {
    setTasks(tasks.filter(t => t.id !== id));
    const newLogs = { ...logs };
    delete newLogs[id];
    setLogs(newLogs);
  };

  const toggleHabit = (taskId, dayIndex) => {
    // PREVENT FUTURE LOGGING: Only allow clicking today or in the past
    if (dayIndex > activeDayIdx) return; 
    setLogs(prev => {
      const taskLogs = prev[taskId] ? { ...prev[taskId] } : {};
      const newValue = taskLogs[dayIndex] === 1 ? 0 : 1;
      return { ...prev, [taskId]: { ...taskLogs, [dayIndex]: newValue } };
    });
  };

  const jumpToToday = () => {
    if (scrollContainerRef.current) {
      const scrollPos = (activeDayIdx - 3) * 56;
      scrollContainerRef.current.scrollLeft = scrollPos;
    }
  };

  const getDayDetails = (idx) => {
    const date = new Date(YEAR, 0, idx + 1);
    return {
      dateStr: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
      dayName: date.toLocaleDateString('en-US', { weekday: 'long' }),
      fullDate: date.toDateString()
    };
  };

  const stats = useMemo(() => {
    const passedDays = activeDayIdx + 1;
    let totalDone = 0;
    let totalPossible = tasks.length * passedDays;

    const categoryStats = categories.map(cat => {
      const catTasks = tasks.filter(t => t.catId === cat.id);
      let catDone = 0;
      catTasks.forEach(t => {
        const tLogs = logs[t.id] || {};
        for(let i=0; i < passedDays; i++) if(tLogs[i] === 1) catDone++;
      });
      const possible = catTasks.length * passedDays;
      return { name: cat.name, value: possible > 0 ? Math.round((catDone / possible) * 100) : 0 };
    });

    const taskAnalytic = tasks.map(t => {
      const tLogs = logs[t.id] || {};
      let current = 0, max = 0, temp = 0;
      for (let i = 0; i <= activeDayIdx; i++) {
        if (tLogs[i] === 1) { temp++; max = Math.max(max, temp); } else { temp = 0; }
      }
      for (let i = activeDayIdx; i >= 0; i--) { if (tLogs[i] === 1) current++; else break; }
      return { name: t.name, current, max };
    });

    const failuresByDay = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => ({ name: d, misses: 0 }));
    Object.entries(logs).forEach(([tId, tLog]) => {
      if (!tasks.find(t => t.id === tId)) return;
      for(let i=0; i <= activeDayIdx; i++) {
        if (!tLog[i]) {
          const dow = new Date(YEAR, 0, i + 1).getDay();
          failuresByDay[dow].misses++;
        } else { totalDone++; }
      }
    });

    let recoveries = 0, misses = 0;
    Object.entries(logs).forEach(([tId, tLog]) => {
      if (!tasks.find(t => t.id === tId)) return;
      for(let i=1; i <= activeDayIdx; i++) {
        if (!tLog[i-1]) { misses++; if (tLog[i] === 1) recoveries++; }
      }
    });

    return {
      overallProgress: totalPossible > 0 ? Math.round((totalDone / totalPossible) * 100) : 0,
      categoryStats,
      taskAnalytic,
      failuresByDay,
      recoveryScore: misses > 0 ? Math.round((recoveries / misses) * 100) : 100,
      bestStreak: Math.max(...taskAnalytic.map(t => t.max), 0)
    };
  }, [logs, categories, tasks, activeDayIdx]);

  return (
    <div className="flex h-screen bg-[#0d0f12] text-slate-200 font-sans overflow-hidden">
      <nav className="w-16 flex-shrink-0 bg-[#15191e] border-r border-white/5 flex flex-col items-center py-6 gap-6 z-50">
        <div className="w-10 h-10 bg-emerald-500 rounded-xl flex items-center justify-center text-white shadow-lg shadow-emerald-500/20">
          <LucideIcon name="Activity" size={24} />
        </div>
        <button 
          onClick={() => { setView('tracker'); setIsManageOpen(false); }}
          className={`p-3 rounded-xl transition-colors ${view === 'tracker' && !isManageOpen ? 'bg-emerald-500/10 text-emerald-400' : 'text-slate-500 hover:bg-white/5'}`}
        >
          <LucideIcon name="CalendarDays" size={22} />
        </button>
        <button 
          onClick={() => { setView('dashboard'); setIsManageOpen(false); }}
          className={`p-3 rounded-xl transition-colors ${view === 'dashboard' ? 'bg-blue-500/10 text-blue-400' : 'text-slate-500 hover:bg-white/5'}`}
        >
          <LucideIcon name="BarChart3" size={22} />
        </button>
        <button 
          onClick={() => setIsManageOpen(!isManageOpen)}
          className={`mt-auto p-3 rounded-xl transition-colors ${isManageOpen ? 'bg-purple-500/10 text-purple-400' : 'text-slate-500 hover:bg-white/5'}`}
        >
          <LucideIcon name="Settings" size={22} />
        </button>
      </nav>

      <div className="flex-grow flex flex-col min-w-0 relative">
        <header className="h-16 border-b border-white/5 bg-[#0d0f12]/80 backdrop-blur-md flex items-center justify-between px-8">
          <div className="flex items-center gap-4">
            <h1 className="text-lg font-bold tracking-tight">
              {isManageOpen ? 'Configuration' : view === 'tracker' ? '2026 Protocol' : 'Insights'}
            </h1>
            <div className="h-4 w-px bg-white/10" />
            <span className="text-sm text-slate-500 font-medium">{YEAR} Roadmap</span>
          </div>
          {!isManageOpen && view === 'tracker' && (
            <div className="flex items-center gap-4">
               <div className="text-[10px] font-mono text-slate-500 flex flex-col items-end">
                  <span className="uppercase font-bold text-emerald-500">System Live</span>
                  <span>Updating Index every 60s</span>
               </div>
               <button onClick={jumpToToday} className="flex items-center gap-2 px-3 py-1.5 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 rounded-lg text-sm font-semibold transition-all">
                <LucideIcon name="Target" size={14} /> Today
              </button>
            </div>
          )}
        </header>

        <div className="flex-grow overflow-auto relative">
          {isManageOpen ? (
            <div className="p-8 max-w-4xl mx-auto space-y-8">
               <section className="bg-[#15191e] p-8 rounded-3xl border border-white/5 shadow-2xl">
                 <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                   <LucideIcon name="Plus" className="text-emerald-500" size={20}/> Add Category
                 </h2>
                 <div className="flex gap-4 items-end">
                   <div className="flex-grow space-y-2">
                     <label className="text-[10px] font-bold text-slate-500 uppercase">Name</label>
                     <input type="text" value={newCatName} onChange={(e) => setNewCatName(e.target.value)} placeholder="e.g., FITNESS" className="w-full bg-[#0d0f12] border border-white/10 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-emerald-500" />
                   </div>
                   <button onClick={addCategory} className="h-[46px] px-6 bg-emerald-500 hover:bg-emerald-400 text-[#0d0f12] font-black rounded-xl transition-all">Create</button>
                 </div>
               </section>
               <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                 {categories.map(cat => (
                   <div key={cat.id} className="bg-[#15191e] rounded-3xl border border-white/5 overflow-hidden flex flex-col">
                     <div className="p-5 flex items-center justify-between border-b border-white/5" style={{ backgroundColor: `${cat.color}10` }}>
                       <span className="font-black text-sm" style={{ color: cat.color }}>{cat.name}</span>
                       <button onClick={() => removeCategory(cat.id)} className="p-2 text-slate-600 hover:text-red-400"><LucideIcon name="Trash2" size={16} /></button>
                     </div>
                     <div className="p-5 space-y-3">
                        {tasks.filter(t => t.catId === cat.id).map(task => (
                          <div key={task.id} className="flex items-center justify-between bg-[#0d0f12] p-3 rounded-xl border border-white/5 group">
                            <span className="text-xs font-medium text-slate-300">{task.name}</span>
                            <button onClick={() => removeTask(task.id)} className="p-1.5 text-slate-700 hover:text-red-400 opacity-0 group-hover:opacity-100"><LucideIcon name="X" size={14} /></button>
                          </div>
                        ))}
                        <div className="pt-2 flex gap-2">
                          <input type="text" placeholder="Add task..." value={newTaskNames[cat.id] || ''} onChange={(e) => setNewTaskNames({ ...newTaskNames, [cat.id]: e.target.value })} className="flex-grow bg-[#0d0f12] border border-white/10 rounded-lg px-3 py-2 text-xs" onKeyDown={(e) => e.key === 'Enter' && addTask(cat.id)} />
                          <button onClick={() => addTask(cat.id)} className="p-2 bg-white/5 hover:bg-white/10 rounded-lg"><LucideIcon name="Plus" size={16} /></button>
                        </div>
                     </div>
                   </div>
                 ))}
               </div>
            </div>
          ) : view === 'tracker' ? (
            <div className="p-6">
              <div className="bg-[#15191e] rounded-2xl border border-white/5 overflow-hidden flex shadow-2xl">
                <div className="w-56 flex-shrink-0 bg-[#0d0f12] border-r border-white/5 z-20">
                  <div className="h-14 flex items-center px-4 border-b border-white/5 text-[10px] uppercase text-slate-500 font-bold">Objective Map</div>
                  {categories.map(cat => (
                    <React.Fragment key={cat.id}>
                      <div className="h-10 flex items-center px-4 bg-white/5 border-b border-white/5 text-xs font-black" style={{ color: cat.color }}>{cat.name}</div>
                      {tasks.filter(t => t.catId === cat.id).map(task => (
                        <div key={task.id} className="h-14 flex items-center px-6 border-b border-white/5 text-xs font-medium text-slate-400 overflow-hidden text-ellipsis whitespace-nowrap">{task.name}</div>
                      ))}
                    </React.Fragment>
                  ))}
                </div>
                <div ref={scrollContainerRef} className="flex-grow overflow-x-auto custom-scrollbar scroll-smooth">
                  <div style={{ width: `${DAYS_IN_YEAR * 56}px` }}>
                    <div className="h-14 flex bg-[#0d0f12] border-b border-white/5">
                      {Array.from({ length: DAYS_IN_YEAR }).map((_, i) => (
                        <div key={i} onClick={() => setSelectedDay(i)} className={`w-14 border-r border-white/5 flex flex-col items-center justify-center cursor-pointer transition-colors ${i === activeDayIdx ? 'bg-emerald-500/20 shadow-[inset_0_0_10px_rgba(16,185,129,0.1)]' : 'hover:bg-white/5'}`}>
                          <span className={`text-[10px] font-mono ${i === activeDayIdx ? 'text-emerald-400 font-black' : 'text-slate-600'}`}>{getDayDetails(i).dateStr}</span>
                          {notes[i] && <div className="w-1.5 h-1.5 rounded-full bg-blue-400 mt-1 shadow-[0_0_8px_rgba(96,165,250,0.6)]" />}
                        </div>
                      ))}
                    </div>
                    {categories.map(cat => (
                      <React.Fragment key={cat.id}>
                        <div className="h-10 flex bg-white/5 border-b border-white/5">
                           {Array.from({ length: DAYS_IN_YEAR }).map((_, i) => <div key={i} className="w-14 border-r border-white/5" />)}
                        </div>
                        {tasks.filter(t => t.catId === cat.id).map(task => (
                          <div key={task.id} className="h-14 flex border-b border-white/5">
                            {Array.from({ length: DAYS_IN_YEAR }).map((_, i) => {
                              const isDone = logs[task.id]?.[i] === 1;
                              const isToday = i === activeDayIdx;
                              return (
                                <div key={i} onClick={() => toggleHabit(task.id, i)} className={`w-14 border-r border-white/5 flex items-center justify-center ${i > activeDayIdx ? 'opacity-20 pointer-events-none' : 'cursor-pointer hover:bg-white/[0.02]'} ${isToday ? 'bg-emerald-500/[0.03]' : ''}`}>
                                  {isDone && <div className="w-8 h-8 rounded-xl shadow-lg" style={{ backgroundColor: cat.color }} />}
                                </div>
                              );
                            })}
                          </div>
                        ))}
                      </React.Fragment>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          ) : (
            <div className="p-8 max-w-6xl mx-auto space-y-8">
              <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div className="bg-[#15191e] p-6 rounded-3xl border border-white/5 shadow-xl">
                  <div className="text-4xl font-black text-white">{stats.overallProgress}%</div>
                  <div className="text-xs text-slate-500 font-bold uppercase mt-2">Overall Progress</div>
                </div>
                <div className="bg-[#15191e] p-6 rounded-3xl border border-white/5 shadow-xl">
                  <div className="text-4xl font-black text-white">{stats.bestStreak}</div>
                  <div className="text-xs text-slate-500 font-bold uppercase mt-2">Best Streak</div>
                </div>
                <div className="bg-[#15191e] p-6 rounded-3xl border border-white/5 shadow-xl">
                  <div className="text-4xl font-black text-white">{stats.recoveryScore}%</div>
                  <div className="text-xs text-slate-500 font-bold uppercase mt-2">Resilience Score</div>
                </div>
                <div className="bg-[#15191e] p-6 rounded-3xl border border-white/5 shadow-xl">
                  <div className="text-4xl font-black text-white">{activeDayIdx + 1}<span className="text-sm font-normal text-slate-600">/365</span></div>
                  <div className="text-xs text-slate-500 font-bold uppercase mt-2">Year Day</div>
                </div>
              </div>
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div className="bg-[#15191e] p-8 rounded-3xl border border-white/5 shadow-xl h-80">
                  <ResponsiveContainer width="100%" height="100%">
                    <RadarChart cx="50%" cy="50%" outerRadius="80%" data={stats.categoryStats}>
                      <PolarGrid stroke="#ffffff10" />
                      <PolarAngleAxis dataKey="name" tick={{fill: '#64748b', fontSize: 11}} />
                      <Radar dataKey="value" stroke="#10b981" fill="#10b981" fillOpacity={0.2} />
                    </RadarChart>
                  </ResponsiveContainer>
                </div>
                <div className="bg-[#15191e] p-8 rounded-3xl border border-white/5 shadow-xl h-80">
                  <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={stats.failuresByDay}>
                      <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#64748b', fontSize: 12}} />
                      <Bar dataKey="misses" radius={[6, 6, 0, 0]} fill="#ef4444" />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>
            </div>
          )}
        </div>

        <aside className={`fixed right-0 top-0 h-full w-80 bg-[#15191e] border-l border-white/10 z-[60] shadow-2xl transition-transform duration-300 ${selectedDay === null ? 'translate-x-full' : 'translate-x-0'}`}>
          {selectedDay !== null && (
            <div className="h-full flex flex-col p-6">
              <div className="flex justify-between items-center mb-8">
                <h4 className="font-bold">{getDayDetails(selectedDay).dateStr}</h4>
                <button onClick={() => setSelectedDay(null)} className="text-slate-500"><LucideIcon name="X" size={20}/></button>
              </div>
              <textarea value={notes[selectedDay] || ''} onChange={(e) => setNotes({...notes, [selectedDay]: e.target.value})} placeholder="Journal entry..." className="w-full h-64 bg-[#0d0f12] border border-white/10 rounded-2xl p-4 text-sm focus:outline-none transition-colors" />
            </div>
          )}
        </aside>
      </div>

      <style dangerouslySetInnerHTML={{ __html: `
        .custom-scrollbar::-webkit-scrollbar { height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #484f58; }
      `}} />
    </div>
  );
};
        // === PASTE ALL CODE FROM THE CANVAS ABOVE THIS LINE ===

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>